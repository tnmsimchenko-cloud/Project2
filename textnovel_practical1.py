import random

print("Добро пожаловать в игру 'Побег из древнего замка'!")
print("Вы очнулись в древнем каменном зале. Воздух сырой и холодный.")
print("Ваши шаги отдаются эхом... В руке - старый факел, едва теплится огонь.")

inventory = ["факел"]
foundkeys = set()
doors = {"первая дверь": "закрыта", "вторая дверь": "закрыта", "выход": "заперт"}
roomcoords = (0, 0)
health = 100
food = {"яблоко": 15, "хлеб": 20}

print("~ Первый уровень: Комната ключей ~")
print("Перед вами пыльная комната. На каменном столе лежат: золотой ключ, меч, старая книга.")
print("В воздухе чувствуется присутствие чего-то древнего...")

while True:
    print(f"Здоровье: {health}")
    process = input("Действие? (взять/осмотреть/инвентарь/исследовать/отдохнуть/зажечь/далее): ")

    if process == "взять":
        element = input("Что взять?: ")
        if element == "золотой ключ":
            foundkeys.add("золотой ключ")
            inventory.append("золотой ключ")
            print("Вы берёте золотой ключ. Он тёплый, будто хранит энергию.")
        elif element == "меч":
            inventory.append("меч")
            print("Вы берёте старый меч. Лезвие треснуто, но острое.")
        elif element == "книга":
            print("Вы открываете книгу. На странице надпись: 'Собери то, что блестит - и путь откроется.'")
        else:
            print("Такого предмета здесь нет.")
    
    elif process == "осмотреть":
        print("Вы замечаете надпись на стене: 'Остерегайся шепчущих теней...'")
    
    elif process == "инвентарь":
        print("Инвентарь:", inventory)
    
    elif process == "исследовать":
        event = random.choice(["монета", "ловушка", "тишина", "осколок"])
        if event == "монета":
            print("Вы находите старинную монету с гербом неизвестного короля.")
            inventory.append("монета короля")
        elif event == "ловушка":
            print("Плита под ногами проваливается! Вы успеваете отпрыгнуть, но ранитесь о камень.")
            health -= 10
        elif event == "тишина":
            print("Вы внимательно прислушиваетесь... кроме вашего дыхания, ничего.")
        elif event == "осколок":
            print("В пыли вы замечаете осколок зеркала. В отражении - будто бы ваше лицо, но чужое выражение...")
            inventory.append("осколок зеркала")
    
    elif process == "отдохнуть":
        print("Вы садитесь на камень и отдыхаете...")
        restevent = random.choice(["тишина", "шорох", "восстановление"])
        if restevent == "восстановление":
            heal = random.randint(5, 15)
            health += heal
            print(f"Вы немного восстановились (+{heal} здоровья).")
        elif restevent == "шорох":
            print("Вы слышите тихий шорох за спиной. Кто-то наблюдает...")
        else:
            print("Тишина... но вы чувствуете тревогу.")
    
    elif process == "зажечь":
        if "факел" in inventory:
            print("Вы подносите огонь ближе - пламя вспыхивает ярче. В углу комнаты мелькнула тень...")
        else:
            print("У вас нет факела.")
    
    elif process == "далее":
        if "золотой ключ" in foundkeys:
            print("Вы открываете дверь золотым ключом. Замок щёлкает, и за дверью виднеется коридор.")
            doors["первая дверь"] = "открыта"
            break
        else:
            print("Дверь заперта. Без ключа не пройти.")
    else:
        print("Неизвестная команда.")

print("~ Второй уровень: Зал cтража ~")
print("Вы входите в зал, освещённый тусклым светом факела. На стенах резные символы.")
print("Из тьмы выступает каменный страж. Его глаза вспыхивают красным светом!")

while True:
    print(f"Здоровье: {health}")
    process = input("Действие? (сразиться/использовать/убежать/инвентарь/прислушаться): ")

    if process == "сразиться":
        if "меч" in inventory:
            print("Вы нападаете со всей силы! Меч разрубает каменного стража пополам.")
            print("Изнутри выпадает сияющий осколок света - вы поднимаете его.")
            inventory.append("осколок света")
            doors["вторая дверь"] = "открыта"
            break
        else:
            print("У вас нет оружия! Страж наносит удар.")
            health -= 20
    
    elif process == "использовать":
        element = input("Что использовать?: ")
        if element == "факел":
            print("Вы подносите факел. Страж замедляется, будто боится света.")
            print("Вы получаете шанс атаковать первыми!")
        elif element == "золотой ключ":
            print("Ключ бесполезен против стража.")
        else:
            print("Это не поможет сейчас.")
    
    elif process == "убежать":
        print("Вы пытаетесь отступить, но дверь за вами закрылась.")
    
    elif process == "инвентарь":
        print("Инвентарь:", inventory)
    
    elif process == "прислушаться":
        print("Вы слышите тихий голос издалека: 'Свет - это ложь... помни это.'")
    
    else:
        print("Неизвестная команда.")

print("~ Третий уровень: Загадка выхода ~")
print("Перед вами массивная дверь с четырьмя буквами. На стене надпись: 'Кто видел зарю - увидит свободу.'")

secretcode = ("з", "а", "р", "я")
tries = 3

while tries > 0:
    code = input("Введите код (4 буквы): ")
    if tuple(code) == secretcode:
        doors["выход"] = "открыт"
        print("Буквы вспыхивают. Дверь открывается, и вас ослепляет свет рассвета.")
        break
    else:
        tries -= 1
        print("Неверно. Осталось попыток:", tries)

if doors["выход"] != "открыт":
    print("Вы слышите гул и чувствуете, как под ногами дрожит пол.")
    print("В стене открывается потайной проход - вы решаете пойти туда...")

print("~ Четвёртый уровень: Комната ловушек ~")
print("Комната освещена лунным светом. Пол усеян трещинами, на стенах блестят кристаллы.")
print("В центре стоит сундук. Возле него яблоко и хлеб.")

while True:
    print("Здоровье: {health}")
    process = input("Действие? (взять/осмотреть/открыть/съесть/инвентарь/исследовать/выйти): ")

    if process == "взять":
        element = input("Что взять?: ")
        if element in food:
            inventory.append(element)
            print(f"Вы берёте {element}.")
        else:
            print("Такого здесь нет.")
    
    elif process == "осмотреть":
        print("На стене надпись: 'Ключ, что отражает луну, ведёт к рассвету.'")
    
    elif process == "открыть":
        print("Вы открываете сундук и находите серебряный ключ, светящийся слабым сиянием.")
        foundkeys.add("серебряный ключ")
        inventory.append("серебряный ключ")
    
    elif process == "исследовать":
        chance = random.randint(1, 3)
        if chance == 1:
            print("Вы замечаете в трещине кристалл. Он тихо поёт, будто живой.")
            inventory.append("поющий кристалл")
        elif chance == 2:
            print("Вы случайно наступаете на плиту - ловушка! Камень падает, задевая вас.")
            health -= 10
        else:
            print("Вы чувствуете странный ветер... словно комната вздыхает.")
    
    elif process == "съесть":
        food_item = input("Что съесть?: ")
        if food_item in inventory and food_item in food:
            health += food[food_item]
            inventory.remove(food_item)
            print(f"Вы съели {food_item} и восстановили здоровье.")
        else:
            print("Вы не можете это съесть.")
    
    elif process == "инвентарь":
        print("Инвентарь:", inventory)
    
    elif process == "выйти":
        if "серебряный ключ" in foundkeys:
            print("Вы открываете последнюю дверь серебряным ключом...")
            print("Перед вами - рассвет. Свежий воздух наполняет лёгкие.")
            print("Вы выбрались из замка... Но вдалеке слышен шёпот: 'Это было лишь начало...'")
            break
        else:
            print("Дверь заперта. Нужен серебряный ключ.")
    else:
        print("Неизвестная команда.")

print("Конец игры!")
print("Ваш финальный инвентарь:", inventory)
print("Найденные ключи:", foundkeys)
print("Открытые двери:", doors)
print("Здоровье:", health)
print("Вы чувствуете ветер свободы. Но где-то в глубине замка снова вспыхивает красный свет...")
print("Конец.")
